---
title: Управление состоянием приложения
type: guide
order: 22
---

## Официальная Flux-подобная библиотека

Сложность больших приложений нередко разрастается из-за распределения кусочков состояния по&nbsp;многим компонентам и&nbsp;связям между ними. Для решения этой проблемы, Vue предлагает [Vuex](https://github.com/vuejs/vuex): нашу собственную библиотеку управления состоянием, вдохновлённую языком Elm. Она даже интегрируется&nbsp;с [Vue-devtools](https://github.com/vuejs/vue-devtools), из&nbsp;коробки давая доступ к&nbsp;функционалу &laquo;машины времени&raquo;.

### Информация для React-разработчиков

Если вы&nbsp;переходите на&nbsp;Vue с&nbsp;React, может быть интересно, как связаны Vuex&nbsp;и [Redux](https://github.com/reactjs/redux), являющийся наиболее популярной имплементацией Flux в&nbsp;React-экосистеме. Redux агностистичен по&nbsp;отношению к&nbsp;слою представления, так что его можно напрямую использовать со&nbsp;Vue, применив [простые байндинги](https://github.com/egoist/revue). Vuex&nbsp;же _знает_, что работает с&nbsp;приложением Vue, что позволяет достичь лучшей интеграции, использовать более интуитивно-понятный API и&nbsp;в&nbsp;результате делает разработку приятнее.

## Простой контейнер состояния с нуля

Часто упускается из&nbsp;виду тот факт, что &laquo;источником истины&raquo; во&nbsp;Vue-приложениях является исходный объект `data`&nbsp;&mdash; инстансы Vue всего лишь проксируют доступ к&nbsp;нему. Поэтому, состояние, которым должны совместно владеть несколько инстансов, можно просто передать по&nbsp;ссылке:

``` js
const sourceOfTruth = {}

const vmA = new Vue({
  data: sourceOfTruth
})

const vmB = new Vue({
  data: sourceOfTruth
})
```

Теперь при любых изменениях `sourceOfTruth` обновится и&nbsp;`vmA`, и&nbsp;`vmB`. Подкомпоненты этих инстансов также имеют доступ&nbsp;&mdash; используя `this.$root.$data`. Эффект &laquo;единого источника истины&raquo; достигнут, но&nbsp;отладка превратится в&nbsp;сущее мучение: любая часть данных может быть изменена любой частью приложения, в&nbsp;любой момент и&nbsp;без каких-либо следов.

Для решения этой проблемы, мы&nbsp;можем использовать простое **хранилище**:

``` js
var store = {
  debug: true,
  state: {
    message: 'Hello!'
  },
  setMessageAction (newValue) {
    this.debug && console.log('setMessageAction вызвано с ', newValue)
    this.state.message = newValue
  },
  clearMessageAction () {
    this.debug && console.log('clearMessageAction вызвано')
    this.state.message = 'clearMessageAction вызвано'
  }
}
```

Обратите внимание, что все действия, изменяющие состояние хранилища, сами помещены в&nbsp;него. Такой подход к&nbsp;централизированному управлению состоянием приложения облегчает понимание возможных изменений и&nbsp;источников их&nbsp;появления. Кроме того, если что-то пойдёт не&nbsp;так&nbsp;&mdash; у&nbsp;нас будет лог, по&nbsp;которому можно отследить последовательность действий, приводящую к&nbsp;возникновению бага.

Каждый инстанс/компонент по-прежнему может иметь собственное, частное состояние:

``` js
var vmA = new Vue({
  data: {
    privateState: {},
    sharedState: store.state
  }
})

var vmB = new Vue({
  data: {
    privateState: {},
    sharedState: store.state
  }
})
```

![Управление состоянием](/images/state.png)

<p class="tip">Важно заметить, что никогда не&nbsp;стоит заменять оригинальный объект состояния в&nbsp;действиях&nbsp;&mdash; компоненты и&nbsp;хранилище должны ссылаться на&nbsp;один и&nbsp;тот&nbsp;же объект, иначе отследить изменения будет невозможно.</p>

Если мы&nbsp;продолжим развивать концепцию, при которой компонентам запрещается прямое изменение состояния хранилища, а&nbsp;вместо этого предполагается обработка событий, указывающих хранилищу на&nbsp;необходимость выполнения тех или иных действий, мы&nbsp;можем прийти к&nbsp;архитектуре [Flux](https://facebook.github.io/flux/). Плюсом такого подхода является возможность записи всех происходящих с&nbsp;хранилищем изменений, что позволяет применять продвинутые техники отладки, такие как логи изменений, слепки данных и&nbsp;&laquo;машину времени&raquo;.

Это вновь приводит нас к&nbsp;[Vuex](https://github.com/vuejs/vuex), так что если вы&nbsp;дочитали до&nbsp;этого места&nbsp;&mdash; пожалуй, пора его попробовать!
